<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubik's Cube Timer - Cubically AI Edition</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Cubing.js for 3D scramble visualization - Using the recommended twisty player module -->
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body class="theme-dark">
    <div class="container mx-auto rounded-3xl">
        <!-- Authentication Controls - Positioned at the top right, uses flex for responsiveness -->
        <div class="flex flex-wrap justify-end gap-2 text-sm auth-corner-buttons">
            <button id="signInBtn" class="button-primary">Sign In</button>
            <button id="signUpBtn" class="button-secondary">Sign Up</button>
            <button id="signOutBtn" class="button-secondary" style="display:none;">Sign Out</button>
        </div>

        <h1 class="text-4xl font-bold text-center text-gradient mb-6">Cubically AI Edition</h1>
        <div class="text-center text-gray-400 mb-4">Welcome, <span id="usernameDisplay" class="font-semibold text-white">Guest</span>!</div>

        <div class="main-content-area">
            <div class="timer-card card">
                <div id="timerDisplay" class="timer-display">00:00.000</div>
                <div class="button-group">
                    <button id="startStopBtn" class="button-primary">Start / Stop (Space)</button>
                    <button id="resetBtn" class="button-secondary">Reset</button>
                </div>
            </div>

            <div class="scramble-card card">
                <h2 class="text-xl font-semibold text-gradient mb-2">Scramble</h2>
                <div id="scrambleTextDisplay" class="scramble-text"></div>
                <!-- 3D Cube Container (initially hidden by default via JS/CSS) -->
                <div id="cube3DContainer" class="twisty-player-container" style="display: none;">
                    <twisty-player
                        id="scramble3DViewer"
                        alg=""
                        puzzle="3x3x3"
                        control-panel="none"
                        background="linear-gradient(to bottom right, #0f172a, #1e293b)"
                        hint-facelets="none"
                        camera-latitude="30"
                        camera-longitude="-150"
                        style="width: 100%; height: 200px; border-radius: 0.75rem; overflow: hidden;"
                    ></twisty-player>
                    <div class="twisty-player-controls">
                        <button id="playPreviewBtn" class="button-secondary"><i class="fas fa-play"></i> Play</button>
                        <button id="pausePreviewBtn" class="button-secondary"><i class="fas fa-pause"></i> Pause</button>
                        <button id="restartPreviewBtn" class="button-secondary"><i class="fas fa-redo"></i> Restart</button>
                    </div>
                </div>
                <button id="scrambleBtn" class="button-secondary mt-4">New Scramble</button>
            </div>
        </div>

        <div class="stats-history-area">
            <div class="stats-card card">
                <h2 class="text-xl font-semibold text-gradient mb-2">Statistics</h2>
                <div class="stats-grid">
                    <div>Best Time: <span id="bestTime" class="stats-value">--:--.--</span></div>
                    <div>Ao5: <span id="ao5" class="stats-value">--:--.--</span></div>
                    <div>Ao12: <span id="ao12" class="stats-value">--:--.--</span></div>
                    <div>Solves: <span id="solveCount" class="stats-value">0</span></div>
                </div>
            </div>

            <div class="history-card card">
                <h2 class="text-xl font-semibold text-gradient mb-2">Solve History</h2>
                <div id="noSolvesMessage" class="text-center text-gray-500 py-4" style="display: block;">No solves yet. Start cubing!</div>
                <div id="solveHistoryList" class="solve-history-list">
                    <!-- Solve items will be dynamically added here -->
                </div>
            </div>
        </div>

        <div class="footer-buttons">
            <button id="settingsBtn" class="button-primary">Settings</button>
            <!-- Voice Command Button - Modernized -->
            <button id="voiceCommandBtn" class="button-primary voice-command-button">
                <i class="fas fa-microphone"></i> Voice Command
            </button>
        </div>
    </div>

    <!-- Voice Feedback Display (NEW) -->
    <div id="voiceFeedbackDisplay" class="voice-feedback-display">
        <span id="voiceListeningText"></span>
        <div class="listening-indicator" id="voiceListeningIndicator">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" role="dialog" aria-modal="true" tabindex="-1">
        <div class="modal-content">
            <button class="modal-close-button" id="closeSettingsModal" aria-label="Close settings">&times;</button>
            <h2 class="text-2xl font-bold text-gradient mb-4">Settings</h2>

            <div class="settings-section">
                <label class="toggle-switch">
                    <input type="checkbox" id="inspectionToggle">
                    <span class="slider"></span>
                </label>
                <span class="ml-3 text-lg">Enable Inspection Time (15s)</span>
            </div>

            <div class="settings-section">
                <label for="cubeTypeSelect" class="text-lg mr-3">Cube Type:</label>
                <select id="cubeTypeSelect" class="select-box">
                    <option value="3x3">3x3</option>
                    <option value="2x2">2x2</option>
                    <option value="pyraminx">Pyraminx</option>
                    <!-- <option value="4x4">4x4</option> -->
                </select>
            </div>

            <div class="settings-section">
                <label for="themeSelect" class="text-lg mr-3">Theme:</label>
                <select id="themeSelect" class="select-box">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                    <option value="vibrant">Vibrant</option>
                </select>
            </div>

            <div class="settings-section">
                <label class="toggle-switch">
                    <input type="checkbox" id="cubeViewToggle">
                    <span class="slider"></span>
                </label>
                <span class="ml-3 text-lg">Show 3D Cube Scramble</span>
            </div>

            <div class="settings-section mt-6">
                <h3 class="text-xl font-semibold text-gradient mb-2">User Profile</h3>
                <div class="flex items-center space-x-3 mb-2">
                    <label for="settingsUsernameInput" class="text-lg">Username:</label>
                    <input type="text" id="settingsUsernameInput" class="input-field flex-grow" placeholder="Enter your username">
                </div>
                <button id="saveUsernameBtn" class="button-primary">Save Username</button>
                <p id="usernameUpdateMessage" class="text-sm mt-2" style="display: none;"></p>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal" role="dialog" aria-modal="true" tabindex="-1">
        <div class="modal-content">
            <button class="modal-close-button" id="closeAuthModal" aria-label="Close authentication">&times;</button>
            <h2 id="authModalTitle" class="text-2xl font-bold text-gradient mb-4">Sign In</h2>
            <div class="mb-4">
                <label for="email" class="block text-gray-300 text-sm font-bold mb-2">Email:</label>
                <input type="email" id="email" class="input-field" placeholder="your@example.com">
            </div>
            <div id="usernameFieldGroup" class="mb-4" style="display:none;">
                <label for="usernameInput" class="block text-gray-300 text-sm font-bold mb-2">Username:</label>
                <input type="text" id="usernameInput" class="input-field" placeholder="Choose a username">
            </div>
            <div class="mb-6">
                <label for="password" class="block text-gray-300 text-sm font-bold mb-2">Password:</label>
                <input type="password" id="password" class="input-field" placeholder="********">
            </div>
            <p id="authError" class="text-red-500 text-sm mb-4" style="display:none;"></p>
            <button id="emailAuthBtn" class="button-primary w-full mb-3">Sign In</button>
            <button id="googleSignInBtn" class="button-secondary w-full flex items-center justify-center">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" class="w-5 h-5 mr-2">
                Sign In with Google
            </button>
        </div>
    </div>

    <!-- AI Insight Modal -->
    <div id="aiInsightModal" class="modal" role="dialog" aria-modal="true" tabindex="-1">
        <div class="modal-content">
            <button class="modal-close-button" id="closeAiInsightModal" aria-label="Close AI insight">&times;</button>
            <h2 class="text-2xl font-bold text-gradient mb-4">Solve Insight âœ¨</h2>
            <div id="aiInsightContent" class="text-gray-300 text-sm sm:text-base">
                <div class="spinner mx-auto my-4" style="display: none;"></div>
                <p id="insightMessage" class="text-center">Generating insight...</p>
                <div id="optimalSolutionDisplay" class="mt-4 p-3 bg-gray-700 rounded-lg" style="display: none;">
                    <h3 class="text-lg font-semibold text-gradient mb-2">Optimal Solution:</h3>
                    <p id="optimalSolutionText" class="font-mono text-white text-sm"></p>
                </div>
                <div id="personalizedTipDisplay" class="mt-4 p-3 bg-gray-700 rounded-lg" style="display: none;">
                    <h3 class="text-lg font-semibold text-gradient mb-2">Personalized Tip:</h3>
                    <p id="personalizedTipText" class="text-white text-sm"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Link to external JavaScript file -->
    <script type="module" src="script.js"></script>
</body>

</html>
