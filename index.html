<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubik's Cube Timer - Cubically AI Edition</title>
    <!-- Tailwind CSS CDN - Note: For production, consider installing Tailwind as a PostCSS plugin or using the Tailwind CLI for optimized builds. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Cubing.js for 3D scramble visualization - Using the recommended twisty player module -->
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body class="theme-dark">
    <div class="container mx-auto rounded-3xl p-6 max-w-5xl w-full"> <!-- Added p-6, max-w-5xl, w-full for better layout control -->
        <!-- Authentication Controls - Positioned at the top right, uses flex for responsiveness -->
        <div class="flex flex-wrap justify-end gap-2 text-sm auth-corner-buttons">
            <button id="signInBtn" class="button-primary">Sign In</button>
            <button id="signUpBtn" class="button-secondary">Sign Up</button>
            <button id="signOutBtn" class="button-secondary" style="display: none;">Sign Out</button>
        </div>

        <div class="username-display-container">
            <span class="text-sm text-gray-400">Current User: <span id="usernameDisplay" class="font-semibold">Guest</span></span>
        </div>

        <h1 class="text-4xl font-bold text-center mb-6">Cubically AI Timer</h1>

        <!-- Main Timer and Scramble Section -->
        <div class="timer-scramble-section mb-6"> <!-- Added mb-6 for spacing -->
            <div id="timerDisplay" class="timer-display">00:00.000</div>
            <div id="scrambleTextDisplay" class="scramble-display">Generating Scramble...</div>
            <div id="cube3DContainer" class="cube-3d-container" style="display: none;">
                <twisty-player id="scramble3DViewer" puzzle="3x3x3" alg="" hint-face-opacity="0.8" background="transparent"></twisty-player>
                <div class="twisty-player-controls">
                    <button id="playPreviewBtn" class="button-secondary"><i class="fas fa-play"></i></button>
                    <button id="pausePreviewBtn" class="button-secondary"><i class="fas fa-pause"></i></button>
                    <button id="restartPreviewBtn" class="button-secondary"><i class="fas fa-redo"></i></button>
                </div>
            </div>
        </div>

        <!-- Timer Controls -->
        <div class="timer-controls mb-6"> <!-- Added mb-6 for spacing -->
            <button id="startStopBtn" class="button-primary">Start / Stop (Space)</button>
            <button id="resetBtn" class="button-secondary">Reset</button>
            <button id="scrambleBtn" class="button-secondary">New Scramble</button>
            <button id="settingsBtn" class="button-secondary">Settings</button>
        </div>

        <!-- NEW WRAPPER FOR STATS AND HISTORY SECTIONS -->
        <div class="flex flex-col md:flex-row md:space-x-6">
            <!-- Statistics Section -->
            <div class="stats-section w-full md:w-1/2 mb-6 md:mb-0"> <!-- Added w-full, md:w-1/2, mb-6, md:mb-0 -->
                <h2 class="text-xl font-semibold mb-3">Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Best Time:</span>
                        <span id="bestTime" class="stat-value">--:--.--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Ao5:</span>
                        <span id="ao5" class="stat-value">--:--.--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Ao12:</span>
                        <span id="ao12" class="stat-value">--:--.--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Solves:</span>
                        <span id="solveCount" class="stat-value">0</span>
                    </div>
                </div>
            </div>

            <!-- Solve History Section -->
            <div class="solve-history-section w-full md:w-1/2"> <!-- Added w-full, md:w-1/2 -->
                <h2 class="text-xl font-semibold mb-3">Solve History</h2>
                <div id="noSolvesMessage" class="text-gray-400 text-center py-4" style="display: none;">No solves recorded yet. Start your first solve!</div>
                <div id="solveHistoryList" class="solve-history-list">
                    <!-- Solve items will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Settings</h2>
            <div class="setting-item">
                <label for="inspectionToggle" class="text-lg">Enable Inspection Time (15s):</label>
                <input type="checkbox" id="inspectionToggle" class="toggle-switch">
            </div>
            <div class="setting-item">
                <label for="soundEffectsToggle" class="text-lg">Enable Sound Effects:</label>
                <input type="checkbox" id="soundEffectsToggle" class="toggle-switch">
            </div>
            <div class="setting-item">
                <label for="cubeTypeSelect" class="text-lg">Cube Type:</label>
                <select id="cubeTypeSelect" class="select-box">
                    <option value="3x3">3x3</option>
                    <option value="2x2">2x2</option>
                    <option value="4x4">4x4</option>
                    <option value="pyraminx">Pyraminx</option>
                </select>
            </div>
            <div class="setting-item">
                <label for="themeSelect" class="text-lg">Theme:</label>
                <select id="themeSelect" class="select-box">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                    <option value="vibrant">Vibrant</option>
                </select>
            </div>
            <div class="setting-item">
                <label for="cubeViewToggle" class="text-lg">Show 3D Cube View:</label>
                <input type="checkbox" id="cubeViewToggle" class="toggle-switch">
            </div>
            <div class="setting-item">
                <label for="settingsUsernameInput" class="text-lg">Username:</label>
                <input type="text" id="settingsUsernameInput" class="text-input" placeholder="Enter your username">
                <button id="saveUsernameBtn" class="button-secondary mt-2">Save Username</button>
                <p id="usernameUpdateMessage" class="text-sm mt-1" style="display: none;"></p>
            </div>
            <button id="closeSettingsModal" class="button-primary mt-6">Close</button>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <h2 id="authModalTitle" class="text-2xl font-bold mb-4">Sign In</h2>
            <div class="input-group">
                <label for="email">Email:</label>
                <input type="email" id="email" class="text-input" placeholder="your.email@example.com">
            </div>
            <div id="usernameFieldGroup" class="input-group" style="display: none;">
                <label for="usernameInput">Username:</label>
                <input type="text" id="usernameInput" class="text-input" placeholder="Your desired username">
            </div>
            <div class="input-group">
                <label for="password">Password:</label>
                <input type="password" id="password" class="text-input" placeholder="********">
            </div>
            <p id="authError" class="text-red-500 text-sm mt-2" style="display: none;"></p>
            <button id="emailAuthBtn" class="button-primary mt-4">Sign In</button>
            <button id="googleSignInBtn" class="button-secondary mt-2"><i class="fab fa-google mr-2"></i>Sign In with Google</button>
            <button id="closeAuthModal" class="button-secondary mt-4">Close</button>
        </div>
    </div>

    <!-- AI Insight Modal -->
    <div id="aiInsightModal" class="modal">
        <div class="modal-content text-left">
            <h2 class="text-2xl font-bold mb-4">Solve Insight âœ¨</h2>
            <div id="aiInsightContent">
                <p id="insightMessage" class="mb-4 text-lg font-medium">Generating insight...</p>
                <div class="spinner"></div> <!-- Loading spinner -->

                <div id="scrambleAnalysisDisplay" class="insight-section" style="display: none;">
                    <h3 class="text-xl font-semibold mt-4 mb-2">Scramble Analysis:</h3>
                    <p id="scrambleAnalysisText"></p>
                </div>

                <div id="personalizedTipDisplay" class="insight-section" style="display: none;">
                    <h3 class="text-xl font-semibold mt-4 mb-2">Personalized Tip:</h3>
                    <p id="personalizedTipText"></p>
                </div>

                <!-- NEW: Targeted Practice Focus Section -->
                <div id="targetedPracticeFocusDisplay" class="insight-section" style="display: none;">
                    <h3 class="text-xl font-semibold mt-4 mb-2">Targeted Practice Focus:</h3>
                    <p id="targetedPracticeFocusText"></p>
                </div>

            </div>
            <button id="closeAiInsightModal" class="button-primary mt-6">Close</button>
        </div>
    </div>

    <!-- Jarvis Orb Voice Feedback Display (moved to bottom center) -->
    <div id="voiceFeedbackDisplay" class="voice-feedback-display">
        <p id="voiceListeningText">Listening for 'Jarvis'...</p>
        <p id="voiceLiveTranscript" class="text-xs text-gray-400 italic mt-1" style="display: none;"></p>
        <div id="voiceListeningIndicator" class="listening-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <!-- Voice Command Button (fixed position) -->
    <button id="voiceCommandBtn" class="fixed bottom-20 right-4 md:bottom-20 md:right-20 z-50 button-primary !rounded-full !w-14 !h-14 !p-0 flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-200">
        <i class="fas fa-microphone text-2xl"></i>
    </button>

    <!-- Chat Button (fixed position, mirroring voice button) -->
    <button id="openChatBtn" class="fixed bottom-20 left-4 md:bottom-20 md:left-20 z-50 button-primary !rounded-full !w-14 !h-14 !p-0 flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-200">
        <i class="fas fa-comment-dots text-2xl"></i>
    </button>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal">
        <div class="modal-content chat-modal-content">
            <h2 class="text-2xl font-bold mb-4">Jarvis Chat</h2>
            <div id="chatHistory" class="chat-history">
                <!-- Chat messages will be dynamically added here -->
            </div>
            <div class="chat-input-area">
                <textarea id="chatInput" class="text-input chat-textarea" placeholder="Type your message to Jarvis..."></textarea>
                <button id="chatSendBtn" class="button-primary chat-send-button">Send</button>
            </div>
            <button id="closeChatModal" class="button-secondary mt-4">Close Chat</button>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>

</html>
