<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubik's Cube Timer - Cubically AI Edition</title>
    <!-- Tailwind CSS CDN - Note: For production, consider installing Tailwind as a PostCSS plugin or using the Tailwind CLI for optimized builds. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Cubing.js for 3D scramble visualization - Using the recommended twisty player module -->
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body class="theme-dark"> <!-- Set default theme class here -->
    <!-- Main Layout Container for Sidebar and Main Content -->
    <div class="main-layout">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar retracted">
            <nav class="space-y-4">
                <!-- Apply 'active' class to the current page's nav-item for gradient -->
                <a href="index.html" class="nav-item active">
                    <i class="fas fa-stopwatch nav-icon"></i>
                    <span class="nav-text">Timer</span>
                </a>
                <a href="lessons.html" class="nav-item">
                    <i class="fas fa-graduation-cap nav-icon"></i>
                    <span class="nav-text">Lessons</span>
                </a>
                <a href="history.html" class="nav-item">
                    <i class="fas fa-history nav-icon"></i>
                    <span class="nav-text">History</span>
                </a>
                <a href="settings.html" class="nav-item">
                    <i class="fas fa-cog nav-icon"></i>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>
            <!-- Authentication Buttons -->
            <div class="auth-section mt-auto space-y-3 w-full">
                <div id="authStatus" class="text-xs text-gray-400 text-center mb-2"></div>
                <button id="authButton" class="button-secondary w-full flex items-center justify-center gap-2">
                    <i class="fas fa-user-circle"></i> Sign In
                </button>
                <button id="googleSignInButton" class="button-secondary w-full flex items-center justify-center gap-2">
                    <i class="fab fa-google"></i> Google Sign In
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="content-area flex-grow p-4 md:p-8 overflow-y-auto">
            <div class="container bg-gray-900 p-6 md:p-10 rounded-2xl shadow-2xl border border-gray-700 flex flex-col gap-8 items-center justify-center relative">
                <!-- Authentication Buttons (Desktop only, absolute positioned) -->
                <div class="auth-corner-buttons hidden md:flex space-x-3">
                    <div id="authStatusDesktop" class="text-xs text-gray-400 flex items-center"></div>
                    <button id="authButtonDesktop" class="button-secondary flex items-center justify-center gap-2">
                        <i class="fas fa-user-circle"></i> Sign In
                    </button>
                    <button id="googleSignInButtonDesktop" class="button-secondary flex items-center justify-center gap-2">
                        <i class="fab fa-google"></i> Google Sign In
                    </button>
                </div>

                <!-- Scramble Display -->
                <div id="scrambleDisplay" class="scramble-display bg-gray-800 p-4 md:p-6 rounded-xl shadow-inner border border-gray-700 text-purple-400 text-xl md:text-2xl font-semibold text-center break-all">
                    Loading Scramble...
                </div>

                <!-- 3D Cube Viewer -->
                <div id="cube3DContainer" class="w-full max-w-md h-64 md:h-80 bg-gray-800 rounded-xl shadow-inner border border-gray-700 flex items-center justify-center relative overflow-hidden">
                    <twisty-player id="twistyPlayer" class="w-full h-full rounded-xl"
                        alg=""
                        puzzle="3x3x3"
                        control-panel="none"
                        background="none"
                        hint-facelets="none"
                        style="--twisty-player-background: var(--bg-color-secondary); --twisty-player-border-radius: 0.75rem;"></twisty-player>
                    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-3">
                        <button id="playPreviewBtn" class="button-preview-control"><i class="fas fa-play"></i></button>
                        <button id="pausePreviewBtn" class="button-preview-control hidden"><i class="fas fa-pause"></i></button>
                        <button id="stepBackwardBtn" class="button-preview-control"><i class="fas fa-step-backward"></i></button>
                        <button id="stepForwardBtn" class="button-preview-control"><i class="fas fa-step-forward"></i></button>
                        <button id="resetAlgBtn" class="button-preview-control"><i class="fas fa-redo"></i></button>
                    </div>
                </div>

                <!-- Timer Display -->
                <div id="timerDisplay" class="timer-display text-blue-400">0.00</div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 w-full justify-center">
                    <button id="generateScrambleBtn" class="button-primary flex-grow flex items-center justify-center gap-2">
                        <i class="fas fa-sync-alt"></i> New Scramble
                    </button>
                    <button id="viewHistoryBtn" class="button-secondary flex-grow flex items-center justify-center gap-2">
                        <i class="fas fa-history"></i> View History
                    </button>
                </div>

                <!-- Statistics Grid -->
                <div class="stats-grid w-full">
                    <div class="stat-card bg-gray-800 p-4 rounded-xl shadow-inner border border-gray-700">
                        <p class="text-sm text-gray-400">Ao5</p>
                        <p id="ao5" class="value text-cyan-400">0.00</p>
                    </div>
                    <div class="stat-card bg-gray-800 p-4 rounded-xl shadow-inner border border-gray-700">
                        <p class="text-sm text-gray-400">Ao12</p>
                        <p id="ao12" class="value text-cyan-400">0.00</p>
                    </div>
                    <div class="stat-card bg-gray-800 p-4 rounded-xl shadow-inner border border-gray-700">
                        <p class="text-sm text-gray-400">Best Time</p>
                        <p id="bestTime" class="value text-green-400">0.00</p>
                    </div>
                    <div class="stat-card bg-gray-800 p-4 rounded-xl shadow-inner border border-gray-700">
                        <p class="text-sm text-gray-400">Total Solves</p>
                        <p id="totalSolves" class="value text-indigo-400">0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Jarvis Orb Voice Feedback Display (moved to bottom center) -->
    <div id="voiceFeedbackDisplay" class="voice-feedback-display">
        <p id="voiceListeningText">Listening for 'Jarvis'...</p>
        <p id="voiceLiveTranscript" class="text-xs text-gray-400 italic mt-1" style="display: none;"></p>
        <div id="voiceListeningIndicator" class="listening-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <!-- Voice Command Button (fixed position) -->
    <button id="voiceCommandBtn" class="fixed bottom-4 right-4 md:bottom-4 md:right-4 z-50 button-primary !rounded-full !w-14 !h-14 !p-0 flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-200">
        <i class="fas fa-microphone text-2xl"></i>
    </button>

    <!-- Chat Button (fixed position, mirroring voice button) -->
    <button id="openChatBtn" class="fixed bottom-4 left-4 md:bottom-4 md:left-4 z-50 button-primary !rounded-full !w-14 !h-14 !p-0 flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-200">
        <i class="fas fa-comment-dots text-2xl"></i>
    </button>


    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- AI Insight Modal -->
    <div id="aiInsightModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" id="closeAiInsightModal">&times;</button>
            <h2 class="text-2xl font-bold text-gradient mb-4">Solve Insight âœ¨</h2>
            <div id="aiInsightContent" class="text-gray-300 text-sm sm:text-base">
                <div class="spinner mx-auto my-4" style="display: none;"></div>
                <p id="insightMessage" class="text-center">Generating insight...</p>
                <div id="scrambleAnalysisDisplay" class="mt-4 p-3 bg-gray-700 rounded-lg" style="display: none;">
                    <h3 class="text-lg font-semibold text-gradient mb-2">Scramble Analysis:</h3>
                    <p id="scrambleAnalysisText" class="text-white text-sm"></p>
                </div>
                <div id="personalizedTipDisplay" class="mt-4 p-3 bg-gray-700 rounded-lg" style="display: none;">
                    <h3 class="text-lg font-semibold text-gradient mb-2">Personalized Tip:</h3>
                    <p id="personalizedTipText" class="text-white text-sm"></p>
                </div>
                <div id="targetedPracticeFocusDisplay" class="mt-4 p-3 bg-gray-700 rounded-lg" style="display: none;">
                    <h3 class="text-lg font-semibold text-gradient mb-2">Targeted Practice Focus:</h3>
                    <p id="targetedPracticeFocusText" class="text-white text-sm"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-button" id="closeChatModal">&times;</button>
            <h2 class="text-2xl font-bold text-gradient mb-4">Jarvis Chat</h2>
            <div id="chatHistory" class="flex-grow overflow-y-auto mb-4 space-y-3 custom-scrollbar">
                <!-- Chat messages will be appended here -->
            </div>
            <div class="chat-input-container">
                <textarea id="chatInput" class="input-field" placeholder="Ask Jarvis anything..." rows="1"></textarea>
                <button id="chatSendBtn" class="button-primary">Send</button>
            </div>
        </div>
    </div>


    <script type="module" src="script.js"></script>
</body>

</html>
